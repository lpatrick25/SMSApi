<ng-container *ngIf="networkStatus">
  <ion-header>
    <ion-toolbar color="primary">
      <ion-buttons slot="start" *ngIf="selectedPhoneNumber">
        <ion-button (click)="goBack()">
          <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
        </ion-button>
      </ion-buttons>

      <ion-title>
        {{ selectedPhoneNumber ? selectedPhoneNumber : 'ğŸ“¨ Sent Messages' }}
      </ion-title>

      <ion-buttons slot="end" *ngIf="!selectedPhoneNumber">
        <ion-button color="light" style="color: white; font-weight: bolder;" (click)="presentSettingsModal()">
          âš™ï¸ Settings
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content>

    <!-- View 1: List of Phone Numbers -->
    <ng-container *ngIf="!selectedPhoneNumber">
      <ion-list *ngIf="objectKeys(groupedMessages).length > 0; else noMessages">
        <ion-item *ngFor="let phone of objectKeys(groupedMessages)" (click)="selectPhoneNumber(phone)">
          <ion-label>
            <h2>{{ phone }}</h2>
            <p>Last message: {{ groupedMessages[phone][groupedMessages[phone].length - 1]?.message }}</p>
          </ion-label>
        </ion-item>
      </ion-list>

      <ng-template #noMessages>
        <div class="no-messages-container">
          <ion-icon name="mail-open-outline" class="no-msg-icon"></ion-icon>
          <ion-text color="medium">
            <h3>No sent messages found.</h3>
            <p>All sent messages will be displayed here!</p>
          </ion-text>
        </div>
      </ng-template>

      <ion-spinner *ngIf="loading" class="center-spinner"></ion-spinner>
    </ng-container>

    <!-- View 2: Messages with Selected Phone Number -->
    <ng-container *ngIf="selectedPhoneNumber">
      <ion-list>
        <ion-item *ngFor="let msg of groupedMessages[selectedPhoneNumber]">
          <ion-label>
            <h3>{{ msg.sentAt | date:'short' }}</h3>
            <p>{{ msg.message }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ng-container>

    <ion-refresher slot="fixed" (ionRefresh)="refreshMessages($event)">
      <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

  </ion-content>

</ng-container>

<!-- Show this when offline -->
<div *ngIf="!networkStatus" class="offline-container">
  <ion-icon name="wifi-outline" size="large" color="danger"></ion-icon>
  <h2>No Internet Connection</h2>
  <p>Please reconnect to continue.</p>

  <!-- Optional: Skeleton shimmer effect -->
  <ion-skeleton-text animated style="width: 80%; height: 100px;"></ion-skeleton-text>
  <ion-skeleton-text animated style="width: 90%; height: 80px; margin-top: 10px;"></ion-skeleton-text>
</div>


